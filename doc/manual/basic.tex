\chapter{Running and Model Checking an Agent Program}
\label{chap:running}

All of the languages implemented using the Agent Infrastructure Layer (AIL)\index{AIL} come provided with a parser which allows files written in that language to be read in and executed.  Examples of programs can be found in the \texttt{src/examples} directory.

However these languages only describe the agent and these agents must execute within an multi-agent system consisting of an environment and one or more agents.  Therefore for any specific example needs to first construct such a multi-agent system.  The language implemented in the AIL all come with classes for parsing input files to sets of agents and many use the \texttt{DefaultEnvironment}\index{Environment!Default} class that come with the AIL. Configuration Files\index{configuration!AIL} can be used to describe the classes necessary  for a given multi-agent system and the class \texttt{ail.mas.AIL}\index{AIL!class} will build and run a multi-agent system from a Configuration file.

Model Checking an agent system uses standard JPF\index{JPF!configuration}\index{configuration!JPF} configuration files which can be supplied to the \texttt{gov.nasa.tool.RunJPF} command at the command line, or to the \texttt{run-ajpf} Run Configuration in Eclipse.  These configuration files should incorporate the line \texttt{@using = mcapl} at the top which should ensure that the correct listeners, etc., for AJPF are configured.  This assumes that the MCAPL project has been added to the JPF \texttt{site.properties} as described in the Installation Instructions (Chapter~\ref{chap:installation}.  A general support class for model checking agent systems configured using an AIL Configuration file has been provided.  This is \texttt{ail.util.AJPF\_w\_AIL}\index{AJPF\_w\_AIL}. 

\section{Example: Executing a Multi-Agent-System (UNIX Based Systems)}
{\bf Important:} Make sure that \texttt{ajpf\_v0.1/bin} and \texttt{ajpf\_v0.1/lib/3rdparty/jpf.jar} are in your CLASSPATH.  We also recommend setting the environment variable AJPF\_HOME\index{AJPF\_HOME} to be the path to \texttt{ajpf\_v0.1}

You can run the simple agent \texttt{pickupagent.gwen} whose code you will find in \texttt{/src/examples/gwendolen/simple/PickUpAgent}\index{example!pickupagent} by calling

\noindent \begin{lstlisting}[basicstyle=\tiny]
> java ail.mas.AIL {$path_to}/src/examples/gwendolen/simple/PickUpAgent/PickUpAgent.ail
\end{lstlisting}
\medskip

\noindent where \texttt{\${path-to}} is the path to ajpf in your system.

You should see output similar to:

\noindent \begin{lstlisting}
 Jun 25, 2012 11:57:24 AM ajpf.util.AJPFLogger info
 INFO: loading property file: /Users/lad/Eclipse/ajpf_v0.1/src/examples/gwendolen/simple/PickUpAgent/PickUpAgent.ail
 done
\end{lstlisting}
\medskip
 
\texttt{PickUpAgent.ail} is a Configuration File which describes how AIL should build the relevant multi-agent system.

{\bf NB}  If you do not have AJPF\_HOME set then you will need to run the example from the \texttt{ajpf\_v0.1} directory.

\subsection{In Eclipse}

If you have successfully imported the project into Eclipse then you should have two run configurations \texttt{run-ail} and \texttt{run-ajpf}.  If you do not these can be found in the \texttt{eclipse} sub-directory.

Select the configuration file you will to run, and then select \texttt{run-ail} from Eclipse's Run Configuration menu.


\section{Example: Model Checking a Multi-Agent System (UNIX Systems)}

You will need to run jpf which uses a class containing in \texttt{lib/3rdparty/jpf.jar}.  Make sure this is on your class path.  Call \emph{in the ajpf\_v0.1} directory:

\noindent \begin{lstlisting}[basicstyle=\tiny]
> java gov.nasa.jpf.tool.RunJPF ${path-to}/src/examples/gwendolen/simple/PickUpAgent/PickUpAgent.jpf
\end{lstlisting}
\medskip

\noindent where \texttt{\${path-to}} is the path to ajpf\_v0.1 in your system.

You should see output similar to: 

\noindent \begin{lstlisting}
 ----------------------------------- search started
       [skipping static init instructions]
 JavaPathfinder v6.0 (rev ${version}) - (C) RIACS/NASA Ames Research Center
 
 
 ====================================================== system under test
 application: gwendolen/simple/SimpleMAS.java
 arguments:   /Users/lad/Eclipse/ajpf_v0.1/src/examples/gwendolen/simple/pickupagent.gwen 
 
 ====================================================== search started: 6/25/12 12:10 PM
                  # choice: gov.nasa.jpf.jvm.choice.ThreadChoiceFromSet {id:"<root>" ,1/1,isCascaded:false}
                  # garbage collection
 [INFO] Adding 0 to []
 ----------------------------------- [1] forward: 0 new
                  # choice: gov.nasa.jpf.jvm.choice.IntChoiceFromSet[id="agentSchedulerChoice",isCascaded:false,>0]
 done
 [INFO] ag1 done print(done)
                  # thread terminated: main index: 0
                  # garbage collection
 [INFO] Always True from Now On
 ----------------------------------- [2] forward: 1 visited end
 ----------------------------------- [1] backtrack: 0
 ----------------------------------- [1] done: 0
 ----------------------------------- [0] backtrack: -1
 ----------------------------------- [0] done: -1
 ----------------------------------- search finished
 
 ====================================================== results
 no errors detected
 
 ====================================================== statistics
 elapsed time:       00:00:02
 states:             new=1, visited=1, backtracked=2, end=1
 search:             maxDepth=1, constraints hit=0
 choice generators:  thread=1 (signal=0, lock=1, shared ref=0), data=1
 heap:               new=24414, released=22348, max live=23869, gc-cycles=2
 instructions:       747288
 max memory:         81MB
 loaded code:        classes=287, methods=3667
 
 ====================================================== search finished: 6/25/12 12:10 PM
\end{lstlisting}

\subsection{In Eclipse}

In eclipse you should be able to select \texttt{run-ajpf} from the Run menu while you have \texttt{src/examples/gwendolen/simple/PickUpAgent/PickUpAgent.jpf} selected.  This should generate similar output to the above.

\section{Executing and Model Checking Multi-Agent Systems on Windows Systems}

AJPF and the AIL have not been extensively tested on Windows systems.  In particular all the examples assume UNIX conventions for path names.  \emph{In theory} however, it should be possible to adapt these to Windows systems simply by converting paths to use Windows style paths.
